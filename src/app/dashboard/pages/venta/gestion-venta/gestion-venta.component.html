<div class="grid text-layout">
    <div class="col-12">
        <p-card>
            <ng-template pTemplate="header">
                <div class="text-center">
                    <h1>Gestión Ventas </h1>
                </div>
            </ng-template>
            <form [formGroup]="ventaForm">
                <div class="grid border-1 border-300 border-round mb-4">
                    <div class="col-12 border-bottom-1 border-300"><b>Datos</b></div>
                    <div class="col-3">
                        <div class="field">
                            <label for="codigoVenta" class="block">Código Fact:</label>
                            <input type="text" pInputText placeholder="Código" formControlName="codigoVenta" />
                            <small class="p-error block" *ngIf="verificarCampo('codigoVenta', ventaForm)">
                                Campo requerido.
                            </small>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="field">
                            <label for="fechaVenta" class="block">Fecha:</label>
                            <span class="p-input-icon-left">
                                <p-calendar  dateFormat="yy-mm-dd" inputId="dateformat" placeholder="yyyy/mm/dd" formControlName="fechaVenta">
                                </p-calendar>
                            </span>
                            <small class="p-error block" *ngIf="verificarCampo('fechaVenta', ventaForm)">
                                Campo requerido.
                            </small>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="field">
                            <label for="formaPago" class="block">Forma Pago:</label>
                            <p-dropdown [options]="formasPago" placeholder="Seleccione..." optionLabel="nombreFormaPago" [showClear]="true" styleClass="w-8" formControlName="formaPago">
                            </p-dropdown>
                            <small class="p-error block" *ngIf="verificarCampo('formaPago', ventaForm)">
                                Campo requerido.
                            </small>
                        </div>
                    </div>
                    <!-- <div class="col-3">
                        <div class="field">
                            <label for="proveedor" class="block">Proveedor:</label>
                            <p-dropdown [options]="proveedores" placeholder="Seleccione..." optionLabel="nombreProveedor" [filter]="true" filterBy="nombreProveedor" [showClear]="true" formControlName="proveedor" styleClass="w-8">
                            </p-dropdown>
                            <small class="p-error block" *ngIf="verificarCampo('proveedor', compraForm)">
                                Campo requerido.
                            </small>
                        </div>
                    </div> -->
                </div>
            </form>
            <form [formGroup]="detalleVentaForm">
                <div class="grid border-1 border-300 border-round ">
                    <div class="col-12 border-bottom-1 border-300"><b>Detalle Venta</b></div>
                    <div class="col-3">
                        <div class="field">
                            <label for="formaPago" class="block">Producto:</label>
                            <p-dropdown [options]="productos" placeholder="Seleccione..." optionLabel="descripcionProducto" [filter]="true" filterBy="descripcionProducto" [showClear]="true" styleClass="w-8" formControlName="producto">
                            </p-dropdown>
                            <small class="p-error block" *ngIf="verificarCampo('producto', detalleVentaForm)">
                                Campo requerido.
                            </small>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="field">
                            <label for="cantidadDetalleProductoVenta" class="block">Cantidad:</label>
                            <input type="number" pInputText placeholder="Cantidad" formControlName="cantidadDetalleCompraProducto" />
                            <small class="p-error block" *ngIf="verificarCampo('cantidadDetalleProductoVenta', detalleVentaForm)">
                                Campo requerido.
                            </small>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="field">
                            <label for="precioDetalleProductoVenta" class="block">Precio:</label>
                            <input type="number" pInputText placeholder="Precio" formControlName="precioDetalleCompraProducto" />
                            <small class="p-error block" *ngIf="verificarCampo('precioDetalleProductoVenta', detalleVentaForm)">
                                Campo requerido.
                            </small>
                        </div>
                    </div>
                    <!-- <div class="col-3">
                        <div class="field">
                            <label for="ivaDetalleCompraProducto" class="block">IVA:</label>
                            <input type="number" pInputText placeholder="IVA" formControlName="ivaDetalleCompraProducto" />
                            <small class="p-error block" *ngIf="verificarCampo('ivaDetalleCompraProducto', detalleCompraForm)">
                                Campo requerido.
                            </small>
                        </div>
                    </div> -->
                </div>
            </form>
            <!-- buttons -->
            <div class="grid">
                <hr>
                <div class="col-12 flex justify-content-evenly mt-2">
                    <button pButton pRipple type="button" label="Agregar Item" class="w-2  p-button-help" (click)="agregarItem()"></button>
                    <button pButton pRipple type="button" label="Cancelar" class="p-button-raised p-button-text w-2" [routerLink]="'/dashboard/compra'"></button>
                </div>
            </div>

            <!-- Tabla items -->
            <div class="mt-1" *ngIf="detallesVenta.length > 0">
                <p-table [value]="detallesVenta" [autoLayout]="true" [rows]="5" [paginator]="true" responsiveLayout="scroll" [rowHover]="true" dataKey="id" currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} productos" [showCurrentPageReport]="true">
                    <ng-template pTemplate="header">
                        <tr>
                            <th>Cantidad</th>
                            <th>Producto</th>
                            <th>Precio Uni.</th>
                            <th>Valor</th>
                            <th>Acciones</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-item let-index>
                        <tr>
                            <td>{{item.cantidadDetalleProductoVenta}}</td>
                            <td>{{item.producto.descripcionProducto}}</td>
                            <td>{{item.precioDetalleProductoVenta}}</td>
                            <td>{{item.totalDetalleProductoVenta}}</td>
                            <td>
                                <div class="grid">
                                    <div class="col-12">
                                        <div class="flex justify-content-between flex-wrap">
                                            <button pButton pRipple type="button" class="p-button-warning" icon="pi pi-pencil" (click)="editarDetalle(item)">
                                            </button>
                                            <button pButton pRipple type="button" class="p-button-danger" icon="pi pi-trash" (click)="quitarProductoItem(item.producto.idProducto)">
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="summary">
                        <div class="flex align-items-center justify-content-between">
                            En total existen {{detallesVenta ? detallesVenta.length : 0 }} Ventas.
                        </div>
                    </ng-template>
                    <ng-template pTemplate="footer">
                        <!-- <tr>
                            <td colspan="3" class="text-right">Subtotal:</td>
                            <td>{{subTotal | currency: 'USD'}}</td>
                            <td></td>
                        </tr> -->
                        <!-- <tr>
                            <td colspan="3" class="text-right">IVA {{ivaGeneral}}%:</td>
                            <td>{{ivaTotal | currency: 'USD'}}</td>
                            <td></td>
                        </tr> -->
                        <tr>
                            <td colspan="3" class="text-right">Total:</td>
                            <td>{{totalVenta | currency: 'USD'}}</td>
                            <td></td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
            <!-- buttons -->
            <div class="grid" *ngIf="detallesVenta.length > 0">
                <hr>
                <div class="col-12 flex justify-content-evenly mt-2">
                    <button pButton pRipple type="button" label="Guardar Compra" class="w-2 p-button-success" (click)="realizarAccion()"></button>
                    <button pButton pRipple type="button" label="Eliminar" class="p-button-danger w-2" *ngIf="id && selectedVenta" (click)="eliminar($event)"></button>
                    <button pButton pRipple type="button" label="Cancelar" class="p-button-raised p-button-text w-2" [routerLink]="'/dashboard/compra'"></button>
                </div>
            </div>
        </p-card>
    </div>
</div>
<!-- popup de confirmacion de eliminar  -->
<p-confirmPopup></p-confirmPopup>
<!-- Modal detalles -->